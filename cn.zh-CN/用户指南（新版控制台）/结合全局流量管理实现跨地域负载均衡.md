# 结合全局流量管理实现跨地域负载均衡 {#concept_hqf_4k5_vdb .concept}

## 全局流量管理 {#section_nyz_jlc_wdb .section}

负载均衡从其应用的地理结构上分为本地负载均衡和全局负载均衡。本地负载均衡是指对同地域的服务器群做负载均衡，全局负载均衡是指对分别部署在不同地域有不同网络结构的服务器群做负载均衡。

结合全局流量管理，您可在本地负载均衡上层部署全局流量管理，实现跨地域容灾、不同区域访问加速和智能解析。

-   多线路智能化解析服务

    全局流量管理利用DNS智能解析和应用服务的运行状态健康检查，将用户访问定向到最合适的IP地址，使访问用户获得最快捷、最流畅的体验。

-   跨地域容灾

    全量流量支持将不同地域的IP地址添加到不同的地址池，并配置健康检查。在访问策略配置中，设置默认地址池为`地址池甲`、Failover地址池为`地址池乙`，即可以实现应用服务主备IP容灾切换。

-   不同区域访问加速

    使用全局流量管理，可以使不同区域的用户访问不同的IP地址池，实现用户分组管理，分组接入，帮助应用服务提高用户访问体验。


## 部署全局流量管理 {#section_zkj_hmc_wdb .section}

本操作以一个域名为aliyuntest.club的网站为例（该网站的大多数用户分布在新加坡和国内），指导您如何通过全局流量管理和负载均衡实现全局负载均衡。

## 步骤一 购买与配置云服务器 {#section_kcf_wcv_y2b .section}

根据您的应用服务的用户的地域分布，在相应地域下购买并配置至少两台ECS。

本操作中，在北京、深圳、新加坡这三个地域分别购买了两台ECS，并在ECS上搭建了一个简单的静态网页。

-   北京地域ECS示例
-   深圳地域ECS示例
-   新加坡地域ECS示例

## 步骤二 购买与配置负载均衡实例 {#section_u35_ypc_wdb .section}

1.  参考[创建负载均衡实例](cn.zh-CN/用户指南（新版控制台）/负载均衡实例/创建负载均衡实例.md#)，分别在北京、深圳、新加坡创建三个公网负载均衡实例。
2.  参考[配置负载均衡实例](../../../../cn.zh-CN/快速入门（新版控制台）/配置负载均衡实例.md#)，添加监听并将各个地域下配置好的ECS添加到后端服务器池。

-   北京地域负载均衡实例示例
-   深圳地域负载均衡实例示例
-   新加坡地域负载均衡实例示例

## 步骤三 配置全局流量管理 {#section_fkw_drc_wdb .section}

1.  购买全局流量管理实例。
    1.  登录[云解析DNS管理控制台](https://dns.console.aliyun.com/#/dns/domainList)。
    2.  在左侧导航栏，单击**全局流量管理**。
    3.  在全局流量管理页面，单击**创建实例**。
    4.  选择套餐版本、购买数量和购买时长。
    5.  单击**立即购买**。

        购买成功后，系统会自动分配一个CNAME接入域名记录。

        ![](http://static-aliyun-doc.oss-cn-hangzhou.aliyuncs.com/assets/img/15689/153553013110621_zh-CN.png)

2.  配置全局流量实例。
    1.  在全局流量管理页面，单击全局流量实例ID或者**操作**列的**配置**。
    2.  在左侧导航栏，单击**配置管理**。
    3.  在全局管理页签下，单击**修改**，配置全局管理实例参数。

        设置以下参数，其他保持默认值。

        -   实例名称：用于识别该实例用于某个应用服务的标识，自定义。
        -   主域名：主域名是用户访问应用服务使用的域名，本操作中设置为aliyuntest.club。
        -   报警通知组：选择全局流量管理服务发声异常时，通知消息发送的对象，自动读取您在云监控产品中创建的报警人联系组。
    4.  单击**确认**。
3.  配置地址池。
    1.  在地址池配置页签下，单击**新增地址池**。
    2.  在新增地址池页面，配置地址池。

        本操作中需要添加三个地址池，将三个不同区域的负载均衡实例地址分别放到三个地址池中。

        -   地址池名称：自定义，例如华北\_北京、华东\_杭州、新加坡。
        -   地址：加入该区域的负载均衡实例的公网地址。
        ![](http://static-aliyun-doc.oss-cn-hangzhou.aliyuncs.com/assets/img/15689/153553013110664_zh-CN.png)

    3.  单击**确认**。
4.  配置健康检查。

    本次操作，需要对三个地址池分别进行健康检查配置。

    1.  在地址池页签下，单击健康检查后的**添加**。
    2.  配置健康检查参数。

        其中，**选择监控节点**表示监控节点的位置信息，不同的区域的地址池选择对应的监控节点。

5.  配置访问策略。

    本次操作，需要对三个不同区域添加不同的访问策略。

    1.  在访问策略页签下，单击**新增访问策略**。
    2.  在新增访问策略页面，配置访问策略。
        -   不同的访问区域配置对应的默认地址池，Failover地址池可以为设置为其他区域的地址池。
        -   选择访问区域，该区域的用户访问应用服务时，匹配该访问策略访问配置的对应地址池。

            必须有一个访问策略中区域选择**全局**，否则，可能会造成部分地区无法访问该应用服务。

6.  配置CNAME接入。
    1.  登录云解析DNS控制台。
    2.  单击aliyuntest.club域名**操作**列的**解析设置**。
    3.  在解析设置页面，单击**添加记录**。
    4.  在添加记录页面，将最终用户访问的aliyuntest.club域名通过CNAME的形式指向全局流量管理实例的别名记录。

        ![](http://static-aliyun-doc.oss-cn-hangzhou.aliyuncs.com/assets/img/15689/153553013110688_zh-CN.png)

    5.  单击**确认**。

## 步骤四 测试 {#section_sxj_ntc_wdb .section}

移除北京地域负载均衡实例的后端服务器，使该负载均衡实例的服务不可用。

访问该网站，查看访问是否正常。

**说明：** 全局流量管理监控到您的IP宕机后需要1-2分钟聚合判断，假设您的监控频率设置是1分钟，那么线路异常切换生效时间在2-3分钟内。

